digraph DementorFlow_Phase2 {
    // Define Nodes
    WebHookHandler [label="WebHookHandler Lambda"];
    QuestionCommandQueue [shape=box3d, label="QuestionCommandQueue"];
    AnswerCommandQueue [shape=box3d, label="AnswerCommandQueue"];
    UndoCommandQueue [shape=box3d, label="UndoCommandQueue"];
    CompleteCommandQueue [shape=box3d, label="CompleteCommandQueue"];
    QuestionCommandHandler [label="QuestionCommandHandler"];
    AnswerCommandHandler [label="AnswerCommandHandler"];
    UndoCommandHandler [label="UndoCommandHandler"];
    CompleteCommandHandler [label="CompleteCommandHandler"];
    DynamoDB [shape=cylinder, label="DynamoDB Table"];
    S3Bucket [shape=folder, label="S3 Bucket"];

    // Define Edges
    WebHookHandler -> AnswerCommandQueue [label="Answer Command"];
    WebHookHandler -> QuestionCommandQueue [label="/start\n/next"];
    WebHookHandler -> UndoCommandQueue [label="/undo"];
    WebHookHandler -> CompleteCommandQueue [label="/complete"];

    AnswerCommandQueue -> AnswerCommandHandler;
    QuestionCommandQueue -> QuestionCommandHandler;
    UndoCommandQueue -> UndoCommandHandler;
    CompleteCommandQueue -> CompleteCommandHandler;

    QuestionCommandHandler -> CompleteCommandQueue [label="All Questions Answered"];
    AnswerCommandHandler -> QuestionCommandQueue [label="/next"];
    UndoCommandHandler -> QuestionCommandQueue [label="/next"];

    AnswerCommandHandler -> DynamoDB [label="Upsert Answer"];
    AnswerCommandHandler -> S3Bucket [label="Store Audio"];
    QuestionCommandHandler -> DynamoDB [label="Mark Latest Question"];
    UndoCommandHandler -> DynamoDB [label="Delete Last Answer"];
}
